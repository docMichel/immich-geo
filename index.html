<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìç Gestionnaire GPS Photos Immich</title>

    <!-- Anti-cache pour d√©veloppement -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <!-- En-t√™te -->
        <header class="header">
            <h1>üìç Gestionnaire GPS Photos Immich</h1>
            <p>Gestion par mois - Copie/Colle GPS entre photos</p>

            <!-- Boutons de d√©veloppement -->
            <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button id="changeTokenBtn" class="btn" style="background: rgba(255,255,255,0.2); color: white;">
                    üîë Changer le token
                </button>
                <button id="reloadBtn" class="btn" style="background: rgba(0,255,0,0.3); color: white;">
                    üîÑ Recharger
                </button>
            </div>
        </header>

        <!-- Navigation par dates -->
        <section class="date-navigation">
            <h2>üìÖ Navigation par dates</h2>

            <div class="date-controls">
                <button id="loadPeriodsBtn" class="btn btn-primary">
                    üîÑ Charger les p√©riodes disponibles
                </button>

                <div class="selectors" id="dateSelectors" style="display: none;">
                    <select id="yearSelect" disabled>
                        <option value="">S√©lectionner une ann√©e...</option>
                    </select>

                    <select id="monthSelect" disabled>
                        <option value="">S√©lectionner un mois...</option>
                    </select>

                    <button id="loadPhotosBtn" class="btn btn-success" disabled>
                        üì• Charger les photos
                    </button>
                </div>
            </div>

            <div id="periodInfo" class="info-box" style="display: none;"></div>
        </section>

        <!-- Progression -->
        <div class="progress-container" id="progressContainer" style="display: none;">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText"></div>
        </div>

        <!-- Statistiques -->
        <section class="stats" id="statsSection" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalPhotos">0</div>
                <div class="stat-label">Photos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="analyzedPhotos">0</div>
                <div class="stat-label">Analys√©es</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="gpsPhotos">0</div>
                <div class="stat-label">Avec GPS</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="noGpsPhotos">0</div>
                <div class="stat-label">Sans GPS</div>
            </div>
        </section>
        <!-- Grille des photos -->
        <section class="photos-section" id="photosSection" style="display: none;">
            <h2>üñºÔ∏è Photos</h2>
            <div class="photos-grid" id="photosGrid"></div>
        </section>
    </div>

    <!-- Zone de messages -->
    <div id="messageContainer"></div>

    <!-- Scripts -->
    <script>
        // Chargement des scripts avec anti-cache
        (function () {
            const timestamp = Date.now();
            console.log('üîÑ Chargement avec timestamp:', timestamp);

            function loadScript(src) {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = src + '?v=' + timestamp;
                    script.onload = resolve;
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }

            async function loadAllScripts() {
                try {
                    await loadScript('api.js');
                    console.log('‚úÖ api.js charg√©');

                    await loadScript('ui.js');
                    console.log('‚úÖ ui.js charg√©');

                    await loadScript('app.js');
                    console.log('‚úÖ app.js charg√©');

                    // Boutons de d√©veloppement
                    initDevButtons();

                } catch (error) {
                    console.error('‚ùå Erreur chargement:', error);
                }
            }

            function initDevButtons() {
                // Changer token
                document.getElementById('changeTokenBtn').onclick = async function () {
                    api.setApiKey(null);
                    const success = await api.promptForApiKey();
                    if (success) {
                        alert('Token mis √† jour !');
                    }
                };

                // Recharger
                document.getElementById('reloadBtn').onclick = function () {
                    location.reload();
                };
            }

            loadAllScripts();
        })();
    </script>
</body>

</html>